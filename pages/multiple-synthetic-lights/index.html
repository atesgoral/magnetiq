<!DOCTYPE html PUBLIC
    "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Magnetiq - Multiple Synthetic Lights</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<link rel="shortcut icon" href="http://s.magnetiq.com/i/favicon.png"/>
<link rel="stylesheet" href="http://s.magnetiq.com/lib/syntaxhighlighter/styles/shCore.css"/>
<link rel="stylesheet" href="http://s.magnetiq.com/lib/syntaxhighlighter/styles/shThemeEclipse.css"/>
<link rel="stylesheet" href="http://s.magnetiq.com/style/layout.css" type="text/css"/>
<link rel="stylesheet" href="http://s.magnetiq.com/style/typography.css" type="text/css"/>
<link rel="stylesheet" href="http://s.magnetiq.com/style/colors.css" type="text/css"/>
<!--[if IE 6]>
<link rel="stylesheet" href="http://s.magnetiq.com/style/fix_ie6.css" type="text/css"/>
<![endif]-->

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="http://s.magnetiq.com/lib/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="http://s.magnetiq.com/lib/syntaxhighlighter/scripts/shBrushJScript.js"></script>
<script type="text/javascript" src="http://s.magnetiq.com/lib/syntaxhighlighter/scripts/shBrushXml.js"></script>
<script type="text/javascript" src="http://s.magnetiq.com/lib/syntaxhighlighter/scripts/shBrushJava.js"></script>
<script type="text/javascript" src="http://s.magnetiq.com/lib/cufon/cufon-yui.js"></script>
<script type="text/javascript" src="http://s.magnetiq.com/lib/cufon/Museo_700_600.font.js"></script>
<script type="text/javascript" src="http://s.magnetiq.com/js/enhance_page.js"></script>

</head>
<body>
<div id="header">
	<div class="fluid_700">
		<div class="one fluid column">
			<h1><a href="/">Magnetiq))</a></h1>
			<div id="description">by Ateş Göral</div>
		</div>
		<div class="clear"></div>
	</div>
</div>

<div id="nav" class="nav fluid_700">
	<ul class="three fluid column">
		<li><a href="/">Home</a></li>
		<li><a href="/#about">About</a></li>
		<li><a href="/#projects">Projects</a></li>
		<li><a href="/#experiments">Experiments</a></li>
		<li><a rel="me" href="http://blog.magnetiq.com/">Blog</a></li>
		<li><a href="http://blog.magnetiq.com/archive">Archive</a></li>
	</ul>
	<div class="clear"></div>
</div>

<div id="content" class="fluid_700">
	<div class="two fluid column post_text"><a href="#" rel="bookmark" title="Permanent Link"><h2>Multiple Synthetic Lights</h2></a>

<p>Multiple photographs taken with different light sources can be blended together to create images that appear to have all the light sources simultaneously active. The light sources can be attributed arbitrary colors as well, allowing the creation of an infinite number of synthetic scenes.</p>

<p>Quoting from <a href="http://www.graficaobscura.com/synth/index.html">Synthetic Lighting for Photography</a> by <strong>Paul Haeberli</strong>:</p>

<blockquote>
Light from different light sources add together to illuminate objects in a scene. We can use this super-position principle to modify the lighting of a scene after it has been photographed...
</blockquote>

<p>I've created an interactive application with three light sources with different colors.</p>

<p class="center">
<applet width="250" height="250" code="Multi_Light" archive="http://magnetiq.com/wp-content/processing/multi_light/multi_light.jar">
</applet>
</p>

<p>Hover over the image to change the intensities of the three light sources.</p>

<p>This Java applet was done using <a href="http://processing.org/">Processing</a>. The source is below. You can also download the <a href="http://magnetiq.com/wp-content/processing/multi_light/multi_light.pde">PDE file</a>.</p>

<pre class="brush: java">
/*
   Multiple Synthetic Lights

   by Ates Goral
   Sometime, 2003

   Based on
   "Synthetic Lighting for Photography"
   by Paul Haeberli
   http://www.sgi.com/misc/grafica/synth/index.html

   Instructions:
   - Roll over the photograph to change the intensities of
     the three different light sources.
*/

// Globals
PImage imgAmb, imgA, imgB, imgC;
float[] ambs, diffA, diffB, diffC;
color clrAmb, clrA, clrB, clrC;
boolean bInitial; // Initial paint?

// Calculate the difference between an image and the ambient
// image
void genDiff(PImage img, float[] arr)
{
    for (int y = 0; y &lt; 250; y++)
    {
        for (int x = 0; x &lt; 250; x++)
        {
            int offs = y * 250 + x;

            float sub = red(img.pixels[offs]) / 255.0 -
            ambs[offs];

            if (sub &lt;< 0)
            {
                sub = 0;
            }

            arr[offs] = sub;
        }
    }
}

void setup()
{
    size(250, 250);
    cursor(CROSS);

    imgAmb = loadImage("lighting-11.jpg"); // Ambient
    imgA = loadImage("lighting-09.jpg");
    imgB = loadImage("lighting-10.jpg");
    imgC = loadImage("lighting-14.jpg");

    ambs = new float[250 * 250];
    diffA = new float[250 * 250];
    diffB = new float[250 * 250];

    diffC = new float[250 * 250];

    for (int y = 0; y &lt;< 250; y++)
    {
        for (int x = 0; x &lt; 250; x++)
        {
            int offs = y * 250 + x;
            // Normalize to 1.0
            ambs[offs] = red(imgAmb.pixels[offs]) / 255.0;
        }
    }

    genDiff(imgA, diffA);
    genDiff(imgB, diffB);
    genDiff(imgC, diffC);
    
    // Colors
    clrAmb = #202A35;
    clrA = #7F1025;
    clrB = #8A8768;
    clrC = #291D80;
    
    bInitial = true; // Enforce initial paint
}

void loop()
{
    // Don't bother if the mouse hasn't moved
    if (pmouseX == mouseX && pmouseY == mouseY && !bInitial)
    {
        return;
    }

    float mX, mY;
    
    if (!bInitial) // If not doing the initial paint,
                    // use mouse input
    {
        mX = mouseX / 250.0;
        mY = mouseY / 250.0;
    }
    else // If doing the inital paint, assume 50% fade
    {
        mX = 0.5;
        mY = 0.5;
        bInitial = false;
    }

    // Coefficients
    float coeffA = pow((1 - mX), 0.5);
    float coeffC = pow(mX, 0.5);
    float coeffB = (1 - mY);
    
    for (int y = 0; y &lt;< 250; y++)
    {
        for (int x = 0; x &lt; 250; x++)
        {
            int offs = y * 250 + x;
            float amb = ambs[offs];
            
            // Contribution of each light source
            float contrA = diffA[offs] * coeffA;
            float contrB = diffB[offs] * coeffB;
            float contrC = diffC[offs] * coeffC;
            
            // Calculate components
            float cmpR = red(clrAmb) * amb +
                red(clrA) * contrA +
                red(clrB) * contrB +
                red(clrC) * contrC;
            
            float cmpG = green(clrAmb) * amb +
                green(clrA) * contrA +
                green(clrB) * contrB +
                green(clrC) * contrC;
            
            float cmpB = blue(clrAmb) * amb +
                blue(clrA) * contrA +
                blue(clrB) * contrB +
                blue(clrC) * contrC;
            
            set(x, y, color(cmpR, cmpG, cmpB));
        }
    }
}
</pre>

<p>The original images I used are below. <del>I had snatched them a while ago from a search result on Google Images but I can't find the actual source anymore. So, this will have to go without credit. Please drop me a comment if you know the source of these images.</del> <ins>They're from the <a href="http://www.megapixel.net/html/articles/article-lightdir.php">"Lighting direction" article</a> at <a href="http://www.megapixel.net/">megapixel.net</a>. I've submitted a belated permission to use these images in this article and I'm waiting for their response.</ins></p>

<p class="center"><img src="http://magnetiq.com/wp-content/uploads/2008/06/lighting-11.jpg" alt="Ambient light" height="250" width="250"/></p>
<p class="center"><small>Ambient Light</small></p>

<p class="center"><img src="http://magnetiq.com/wp-content/uploads/2008/06/lighting-09.jpg" alt="Light coming from the left" height="250" width="250"/></p>
<p class="center"><small>Light coming from the left</small></p>

<p class="center"><img src="http://magnetiq.com/wp-content/uploads/2008/06/lighting-10.jpg" alt="Light coming from the top" height="250" width="250"/></p>
<p class="center"><small>Light coming from the top</small></p>

<p class="center"><img src="http://magnetiq.com/wp-content/uploads/2008/06/lighting-14.jpg" alt="Light coming from the right" height="250" width="250"/></p>
<p class="center"><small>Light coming from the right</small></p>
</div>
	<div class="clear"></div>
</div>

<div id="footer">
	<div class="fluid_700">
		<div class="three fluid column">
			&copy; Ateş Göral -
			Licensed under a <a href="http://creativecommons.org/licenses/by-nc/2.0/">Creative Commons License</a> -
			Kick-ass hosting by <a href="http://www.webfaction.com/?affiliate=atesgoral">WebFaction</a>
			Powered by static HTML generated through <a href="http://www.python.org/">Python</a> -
			Using a fluid grid (<a id="toggle_grid" href="#">toggle</a>)
		</div>
		<div class="clear"></div>
	</div>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-912088-1");
pageTracker._setDomainName(".magnetiq.com");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
